<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="None">
  
  
  <link rel="shortcut icon" href="img/favicon.ico">
  <title>OAP MLlib - master</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="css/theme.css" />
  <link rel="stylesheet" href="css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "User Guide";
    var mkdocs_page_input_path = "index.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="js/jquery-2.1.1.min.js" defer></script>
  <script src="js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="." class="icon icon-home"> OAP MLlib - master</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="./search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href=".">User Guide</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#compatibility">Compatibility</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#getting-started">Getting Started</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#javascala-users-preferred">Java/Scala Users Preferred</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#pythonpyspark-users-preferred">Python/PySpark Users Preferred</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#building-from-scratch">Building From Scratch</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#running">Running</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#prerequisites">Prerequisites</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#spark-configuration">Spark Configuration</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#sanity-check">Sanity Check</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#benchmark-with-hibench">Benchmark with HiBench</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#pyspark-support">PySpark Support</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#building">Building</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#prerequisites_1">Prerequisites</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#build">Build</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#building-oneccl">Building oneCCL</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#building-oap-mllib">Building OAP MLlib</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#examples">Examples</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#list-of-accelerated-algorithms">List of Accelerated Algorithms</a>
    </li>
    </ul>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="OAP-Installation-Guide/">OAP Installation Guide</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="OAP-Developer-Guide/">OAP Developer Guide</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="" href="../">Version Selector</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href=".">OAP MLlib - master</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".">Docs</a> &raquo;</li>
    
      
    
    <li>User Guide</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="oap-mllib">OAP MLlib</h1>
<h2 id="overview">Overview</h2>
<p>OAP MLlib is an optimized package to accelerate machine learning algorithms in  <a href="https://spark.apache.org/mllib">Apache Spark MLlib</a>.  It is compatible with Spark MLlib and leverages open source <a href="https://github.com/oneapi-src/oneDAL">Intel速 oneAPI Data Analytics Library (oneDAL)</a> to provide highly optimized algorithms and get most out of CPU and GPU capabilities. It also take advantage of open source <a href="https://github.com/oneapi-src/oneCCL">Intel速 oneAPI Collective Communications Library (oneCCL)</a> to provide efficient communication patterns in multi-node multi-GPU clusters.</p>
<h2 id="compatibility">Compatibility</h2>
<p>OAP MLlib tried to maintain the same API interfaces and produce same results that are identical with Spark MLlib. However due to the nature of float point operations, there may be some small deviation from the original result, we will try our best to make sure the error is within acceptable range.
For those algorithms that are not accelerated by OAP MLlib, the original Spark MLlib one will be used. </p>
<h2 id="getting-started">Getting Started</h2>
<h3 id="javascala-users-preferred">Java/Scala Users Preferred</h3>
<p>Use a pre-built OAP MLlib JAR to get started. You can firstly download OAP package from <a href="https://github.com/Intel-bigdata/OAP/releases/download/v1.0.0-spark-3.0.0/oap-1.0.0-bin-spark-3.0.0.tar.gz">OAP-JARs-Tarball</a> and extract this Tarball to get <code>oap-mllib-x.x.x-with-spark-x.x.x.jar</code> under <code>oap-1.0.0-bin-spark-3.0.0/jars</code>.</p>
<p>Then you can refer to the following <a href="#running">Running</a> section to try out.</p>
<h3 id="pythonpyspark-users-preferred">Python/PySpark Users Preferred</h3>
<p>Use a pre-built JAR to get started. If you have finished <a href="OAP-Installation-Guide/">OAP-Installation-Guide</a>, you can find compiled OAP MLlib JAR <code>oap-mllib-x.x.x-with-spark-x.x.x.jar</code> in <code>$HOME/miniconda2/envs/oapenv/oap_jars/</code>.</p>
<p>Then you can refer to the following <a href="#running">Running</a> section to try out.</p>
<h3 id="building-from-scratch">Building From Scratch</h3>
<p>You can also build the package from source code, please refer to <a href="#building">Building</a> section.</p>
<h2 id="running">Running</h2>
<h3 id="prerequisites">Prerequisites</h3>
<ul>
<li>CentOS 7.0+, Ubuntu 18.04 LTS+</li>
<li>Java JRE 8.0+ Runtime</li>
<li>Apache Spark 3.0.0+</li>
</ul>
<p>Generally, our common system requirements are the same with Intel速 oneAPI Toolkit, please refer to <a href="https://software.intel.com/content/www/us/en/develop/articles/intel-oneapi-base-toolkit-system-requirements.html">here</a> for details.</p>
<p>Intel速 oneAPI Toolkits components used by the project are already included into JAR package mentioned above. There are no extra installations for cluster nodes.</p>
<h3 id="spark-configuration">Spark Configuration</h3>
<p>Users usually run Spark application on <strong>YARN</strong> with <strong>client</strong> mode. In that case, you only need to add the following configurations in <code>spark-defaults.conf</code> or in <code>spark-submit</code> command line before running. </p>
<pre><code># absolute path of the jar for uploading
spark.files                       /path/to/oap-mllib-x.x.x-with-spark-x.x.x.jar
# absolute path of the jar for driver class path
spark.driver.extraClassPath       /path/to/oap-mllib-x.x.x-with-spark-x.x.x.jar
# relative path to spark.files, just specify jar name in current dir
spark.executor.extraClassPath     ./oap-mllib-x.x.x-with-spark-x.x.x.jar
</code></pre>
<h3 id="sanity-check">Sanity Check</h3>
<p>To use K-means example for sanity check, you need to upload a data file to your HDFS and change related variables in <code>run.sh</code> of kmeans example. Then run the following commands:</p>
<pre><code>    $ cd OAP/oap-mllib/examples/kmeans
    $ ./build.sh
    $ ./run.sh
</code></pre>
<h3 id="benchmark-with-hibench">Benchmark with HiBench</h3>
<p>Use <a href="https://github.com/Intel-bigdata/HiBench">Hibench</a> to generate dataset with various profiles, and change related variables in <code>run-XXX.sh</code> script when applicable.  Then run the following commands:</p>
<pre><code>    $ cd OAP/oap-mllib/examples/kmeans-hibench
    $ ./build.sh
    $ ./run-hibench-oap-mllib.sh
</code></pre>
<h3 id="pyspark-support">PySpark Support</h3>
<p>As PySpark-based applications call their Scala couterparts, they shall be supported out-of-box. An example can be found in the <a href="#examples">Examples</a> section.</p>
<h2 id="building">Building</h2>
<h3 id="prerequisites_1">Prerequisites</h3>
<p>We use <a href="https://maven.apache.org/">Apache Maven</a> to manage and build source code.  The following tools and libraries are also needed to build OAP MLlib:</p>
<ul>
<li>JDK 8.0+</li>
<li>Apache Maven 3.6.2+</li>
<li>GNU GCC 4.8.5+</li>
<li>Intel速 oneAPI Toolkits 2021.1.1 Components: <ul>
<li>Data Analytics Library (oneDAL)</li>
<li>Threading Building Blocks (oneTBB)</li>
</ul>
</li>
<li><a href="https://github.com/oneapi-src/oneCCL">Open Source Intel速 oneAPI Collective Communications Library (oneCCL)</a></li>
</ul>
<p>Intel速 oneAPI Toolkits and its components can be downloaded and install from <a href="https://software.intel.com/content/www/us/en/develop/tools/oneapi.html">here</a>. Installation process for oneAPI using Package Managers (YUM (DNF), APT, and ZYPPER) is also available. Generally you only need to install oneAPI Base Toolkit for Linux with all or selected components mentioned above. Instead of using oneCCL included in Intel速 oneAPI Toolkits, we prefer to build from open source oneCCL to resolve some bugs.</p>
<p>More details about oneAPI can be found <a href="https://software.intel.com/content/www/us/en/develop/tools/oneapi.html">here</a>.</p>
<p>You can also refer to <a href="https://github.com/Intel-bigdata/OAP/blob/branch-1.0-spark-3.x/oap-mllib/dev/install-build-deps-centos.sh">this script and comments in it</a> to install correct oneAPI version and manually setup the environments.</p>
<p>Scala and Java dependency descriptions are already included in Maven POM file. </p>
<h3 id="build">Build</h3>
<h4 id="building-oneccl">Building oneCCL</h4>
<p>To clone and build from open source oneCCL, run the following commands:</p>
<pre><code>    $ git clone https://github.com/oneapi-src/oneCCL
        $ cd oneCCL
        $ git checkout beta08
    $ mkdir build &amp;&amp; cd build
    $ cmake ..
    $ make -j install
</code></pre>
<p>The generated files will be placed in <code>/your/oneCCL_source_code/build/_install</code></p>
<h4 id="building-oap-mllib">Building OAP MLlib</h4>
<p>To clone and checkout source code, run the following commands:</p>
<pre><code>    $ git clone https://github.com/Intel-bigdata/OAP    
</code></pre>
<p><strong>Optional</strong> to checkout specific release branch:</p>
<pre><code>    $ git checkout -b branch-1.0-spark-3.x origin/branch-1.0-spark-3.x
</code></pre>
<p>We rely on environment variables to find required toolchains and libraries. Please make sure the following environment variables are set for building:</p>
<table>
<thead>
<tr>
<th>Environment</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>JAVA_HOME</td>
<td>Path to JDK home directory</td>
</tr>
<tr>
<td>DAALROOT</td>
<td>Path to oneDAL home directory</td>
</tr>
<tr>
<td>TBB_ROOT</td>
<td>Path to oneTBB home directory</td>
</tr>
<tr>
<td>CCL_ROOT</td>
<td>Path to oneCCL home directory</td>
</tr>
</tbody>
</table>
<p>We suggest you to source <code>setvars.sh</code> script into current shell to setup building environments as following:</p>
<pre><code>    $ source /opt/intel/inteloneapi/setvars.sh
    $ source /your/oneCCL_source_code/build/_install/env/setvars.sh
</code></pre>
<p><strong>Be noticed we are using our own built oneCCL instead, we should source oneCCL's <code>setvars.sh</code> to overwrite oneAPI one.</strong></p>
<p>If you prefer to buid your own open source <a href="https://github.com/oneapi-src/oneDAL">oneDAL</a>, <a href="https://github.com/oneapi-src/oneTBB">oneTBB</a> versions rather than use the ones included in oneAPI TookKits, you can refer to the related build instructions and manually source <code>setvars.sh</code> accordingly.</p>
<p>To build, run the following commands: </p>
<pre><code>    $ cd OAP/oap-mllib/mllib-dal
    $ ./build.sh
</code></pre>
<p>The built JAR package will be placed in <code>target</code> directory with the name <code>oap-mllib-x.x.x-with-spark-x.x.x.jar</code>.</p>
<h2 id="examples">Examples</h2>
<table>
<thead>
<tr>
<th>Example</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>kmeans</td>
<td>K-means example for Scala</td>
</tr>
<tr>
<td>kmeans-pyspark</td>
<td>K-means example for PySpark</td>
</tr>
<tr>
<td>kmeans-hibench</td>
<td>Use HiBench-generated input dataset to benchmark K-means performance</td>
</tr>
</tbody>
</table>
<h2 id="list-of-accelerated-algorithms">List of Accelerated Algorithms</h2>
<ul>
<li>K-Means (CPU, Experimental)</li>
</ul>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="OAP-Installation-Guide/" class="btn btn-neutral float-right" title="OAP Installation Guide">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
      
        <span style="margin-left: 15px"><a href="OAP-Installation-Guide/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '.';</script>
    <script src="js/theme.js" defer></script>
      <script src="search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>

<!--
MkDocs version : 1.1.2
Build Date UTC : 2021-01-12 01:32:21.858418+00:00
-->
